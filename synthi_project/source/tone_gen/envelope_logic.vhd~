-------------------------------------------------------------------------------
-- Title      : evelop logic
-- Project    : 
-------------------------------------------------------------------------------
-- File       : envelope_logic.vhd
-- Author     : Mueller Pavel
-- Company    : 
-- Created    : 2021-05-06
-- Last update: 2021-05-06
-- Platform   : 
-- Standard   : VHDL'08
-------------------------------------------------------------------------------
-- Description: -
-------------------------------------------------------------------------------
-- Copyright (c) 2021 
-------------------------------------------------------------------------------
-- Revisions  :
-- Date        Version  Author          Description
-- 2021-05-06  1.0      Mueller Pavel	Created
-------------------------------------------------------------------------------

-- Library & Use Statements
-------------------------------------------
library ieee;
use ieee.std_logic_1164.all;
use ieee.numeric_std.all;
library work;
use work.tone_gen_pkg.all;

entity envelope_logic is
  
  port (
    clk_6m       : in  std_logic;
    reset_n    : in  std_logic;
    tone_on_i  : in  std_logic;
    velocity_i : in  std_logic_vector(6 downto 0);
    lut_sel    : in  std_logic_vector(3 downto 0);
    attenu_o   : out std_logic_vector(3 downto 0)
    );
end envelope_logic;
   
architecture rtl begin  -- architecture rtl

  signal count,next_count : unsigned(N_CUM-1 downto 0);

  counter_register: process (all) is
  begin  -- process counter_register
   if reset_n = '0' then
      count <= to_unsigned(0, N_CUM);
    elsif rising_edge(clk_6m) then
      count <= next_count;
    end if;
   end process counter_register;

  counter_logic: process (all) is
  begin  -- process counter_logic
    next_count <= count;

    if tone_on_i = '1' then
      next_count = count + to_unsigned(1,N_CUM);
    end if;
  end process counter_logic;
      

end architecture rtl;
